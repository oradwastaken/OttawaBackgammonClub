<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ottawa Area Backgammon Club - Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/variables.css">
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/modals.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
<script type="module" src="js/main.js"></script>
</head>
<body>

<div id="loading-overlay" class="loading-overlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Loading dashboard data...</div>
</div>
<div id="data-error" class="data-error" style="display:none;">
  <div class="data-error-icon">&#9888;</div>
  <div id="data-error-msg" class="data-error-message"></div>
  <button class="upload-btn" onclick="openUploadModal()">Upload Excel Data</button>
</div>

<div class="container">
  <!-- Header -->
  <div class="header fade-in">
    <div class="header-tools">
      <button class="theme-toggle" id="uploadBtn" onclick="openUploadModal()" title="Upload Excel data">&#128203;</button>
      <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark theme">&#9790;</button>
    </div>
    <div class="header-badge">Est. 2017 &bull; Weekly Tournaments</div>
    <h1>Ottawa Area Backgammon Club</h1>
    <p id="header-subtitle">Player Statistics &amp; Performance Dashboard &mdash; 396 Tournaments &bull; 85 Players &bull; 2017 &ndash; 2026</p>
    <p id="data-source-info" class="data-source-info">Data: Built-in defaults</p>
  </div>

  <!-- Summary Stats -->
  <div class="summary-row">
    <div class="summary-stat fade-in stagger-1" style="--stat-accent: var(--accent-gold);">
      <div class="number" id="stat-tournaments">286</div>
      <div class="label">Tournaments</div>
    </div>
    <div class="summary-stat fade-in stagger-2" style="--stat-accent: var(--accent-blue);">
      <div class="number" id="stat-players">60</div>
      <div class="label">Players</div>
    </div>
    <div class="summary-stat fade-in stagger-3" style="--stat-accent: var(--accent-emerald);">
      <div class="number" id="stat-games">4,208</div>
      <div class="label">Total Games</div>
    </div>
    <div class="summary-stat fade-in stagger-4" style="--stat-accent: var(--accent-purple);">
      <div class="number" id="stat-years">7</div>
      <div class="label">Seasons</div>
    </div>
  </div>

  <!-- Leaderboard Section -->
  <div class="leaderboard-section">
    <div class="leaderboard-grid">
      <!-- Left: Podium + Table -->
      <div class="card fade-in" style="padding-bottom: 16px;">
        <div class="card-title"><span class="dot" style="background: var(--accent-gold);"></span> All-Time Points Leaderboard</div>
        <div class="podium" id="podium"></div>
        <div class="table-rest">
          <div class="table-row table-header">
            <span class="rank">#</span>
            <span class="name">Player</span>
            <span class="stat-val">Points</span>
            <span class="stat-val">W-L</span>
            <span class="stat-val">PPT</span>
          </div>
          <div id="leaderboard-table"></div>
        </div>
      </div>

      <!-- Right: Horizontal bar chart -->
      <div class="card fade-in leaderboard-chart-wrap">
        <div class="card-title"><span class="dot" style="background: var(--accent-blue);"></span> Top 10 Points Breakdown</div>
        <div class="chart-container" style="min-height: 400px;">
          <canvas id="pointsBreakdownChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- 4 Mini Leaderboards -->
  <div class="stats-grid">
    <div class="card fade-in stagger-1">
      <div class="card-title"><span class="dot" style="background: var(--accent-emerald);"></span> Top 10 Win Rate</div>
      <div class="mini-board-note" style="font-size: 10px; color: var(--text-muted); margin-bottom: 12px; margin-top: -12px;">Min. 5 tournaments</div>
      <ul class="mini-board" id="board-winrate"></ul>
    </div>
    <div class="card fade-in stagger-2">
      <div class="card-title"><span class="dot" style="background: var(--accent-cyan);"></span> Top 10 Points/Tournament</div>
      <div class="mini-board-note" style="font-size: 10px; color: var(--text-muted); margin-bottom: 12px; margin-top: -12px;">Min. 5 tournaments</div>
      <ul class="mini-board" id="board-ppt"></ul>
    </div>
    <div class="card fade-in stagger-3">
      <div class="card-title"><span class="dot" style="background: var(--accent-purple);"></span> Top 10 % Placed</div>
      <div class="mini-board-note" style="font-size: 10px; color: var(--text-muted); margin-bottom: 12px; margin-top: -12px;">Min. 5 tournaments</div>
      <ul class="mini-board" id="board-placed"></ul>
    </div>
    <div class="card fade-in stagger-4">
      <div class="card-title"><span class="dot" style="background: var(--accent-orange);"></span> Top 10 Attendance</div>
      <ul class="mini-board" id="board-attendance"></ul>
    </div>
  </div>

  <!-- Cumulative Points & Attendance Charts -->
  <div class="charts-grid-2">
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-gold);"></span> Cumulative Points Over Years</div>
      <div class="chart-container">
        <canvas id="cumulativeChart"></canvas>
      </div>
    </div>
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-cyan);"></span> Weekly Attendance</div>
      <div class="chart-container">
        <canvas id="attendanceChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Win Rate & PPT Distribution -->
  <div class="charts-grid-2">
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-emerald);"></span> Win Rate Distribution</div>
      <div class="mini-board-note" style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px; margin-top: -12px;">Players with 5+ tournaments</div>
      <div class="chart-container" style="min-height: 240px;">
        <canvas id="winRateDistChart"></canvas>
      </div>
    </div>
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-purple);"></span> Points Per Tournament Distribution</div>
      <div class="mini-board-note" style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px; margin-top: -12px;">Players with 5+ tournaments</div>
      <div class="chart-container" style="min-height: 240px;">
        <canvas id="pptDistChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Year-over-Year + Attendance by Year -->
  <div class="charts-grid-2">
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-rose);"></span> Yearly Points &mdash; Top 5 Players</div>
      <div class="chart-container">
        <canvas id="yearlyPointsChart"></canvas>
      </div>
    </div>
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-blue);"></span> Club Growth &mdash; Yearly Overview</div>
      <div class="chart-container">
        <canvas id="yearlyOverviewChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Win/Loss Ratio Top 10 & Head-to-Head Radar -->
  <div class="charts-grid-2">
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-orange);"></span> Win vs Loss &mdash; Top 10 Players</div>
      <div class="chart-container">
        <canvas id="winLossChart"></canvas>
      </div>
    </div>
    <div class="card fade-in">
      <div class="card-title"><span class="dot" style="background: var(--accent-gold);"></span> Player Comparison Radar</div>
      <div class="filter-row" id="radar-filters"></div>
      <div class="chart-container">
        <canvas id="radarChart"></canvas>
      </div>
    </div>
  </div>

  <div class="footer">
    Ottawa Area Backgammon Club &bull; Data from March 2017 to February 2026 &bull; 396 Weekly Tournaments
  </div>
</div>

<!-- Player Detail Modal -->
<div class="modal-overlay" id="playerModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <h2 id="modal-name"></h2>
    <div class="modal-subtitle" id="modal-subtitle"></div>
    <div class="modal-stats" id="modal-stats"></div>
    <div class="modal-chart">
      <canvas id="modalChart"></canvas>
    </div>
  </div>
</div>

<!-- Upload Modal -->
<div class="modal-overlay" id="uploadModal">
  <div class="modal" style="max-width: 480px;">
    <button class="modal-close" onclick="closeUploadModal()">&times;</button>
    <h2>Update Dashboard Data</h2>
    <div class="modal-subtitle">Upload the latest Excel spreadsheet to refresh all stats</div>
    <div class="upload-drop-zone" id="upload-drop-zone" onclick="document.getElementById('upload-file-input').click()">
      <div class="upload-icon">&#128196;</div>
      <div class="upload-text">Drag &amp; drop your Excel file here</div>
      <div class="upload-subtext">or click to browse</div>
      <input type="file" id="upload-file-input" accept=".xlsx,.xls" style="display:none" onchange="handleFileUpload(this.files[0])">
    </div>
    <div id="upload-status" class="upload-status"></div>
    <div id="upload-actions" class="upload-actions" style="display:none;">
      <button class="upload-btn upload-btn-apply" onclick="applyUploadedData()">Apply Data</button>
      <button class="upload-btn upload-btn-cancel" onclick="closeUploadModal()">Cancel</button>
    </div>
    <div id="publish-actions" class="export-actions" style="display:none;">
      <button class="upload-btn publish-btn" onclick="publishToGitHub()" style="width:100%" id="publish-btn">Publish</button>
      <div id="publish-status" class="publish-status"></div>
    </div>
    <div id="github-settings" class="github-settings" style="display:none;">
      <div class="github-settings-title">Connection Settings <span class="github-settings-hint">(one-time setup)</span></div>
      <label class="github-label">Repository</label>
      <input type="text" id="gh-repo" class="github-input" placeholder="e.g. JohnSmith/OttawaBackgammonClub">
      <label class="github-label">Access Token</label>
      <input type="password" id="gh-token" class="github-input" placeholder="ghp_xxxxxxxxxxxx">
      <button class="upload-btn upload-btn-apply" onclick="saveGitHubSettings()" style="width:100%; margin-top:8px;">Save Settings</button>
    </div>
    <div class="upload-reset">
      <a href="#" onclick="toggleGitHubSettings(); return false;" id="gh-settings-link">Settings</a>
    </div>
  </div>
</div>

</body>
</html>
